In the main function, I found errors with the provided section of the code and left it as is since I assume it will be fixed
with a patched version of the original code. See comments in main function for more details.
